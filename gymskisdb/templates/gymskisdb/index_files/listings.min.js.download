window.wp=window.wp||{},function(i,t){i.wp=i.wp||{};var e,a=i.document,n=i.jQuery,r=wp.listifyResults||{};r.DataServices=[],r.DataService=r.Class.extend({response:null,activeResponse:n.Deferred(),resultTemplate:wp.template("listingCard"),noResultsTemplate:wp.template("noResults"),resultsContainer:"ul.job_listings",columns:r.settings.displayColumns,initialize:function(e){n.extend(this,e||{})},update:function(){},getDefaultCoordinates:function(){},addResults:function(e){i.console&&r.settings.scriptDebug&&console.log("Adding results...");var t=this,s=this.resultsContainer;_.isUndefined(e)||_.isUndefined(e.resultsContainer)||(this.resultsContainer=e.resultsContainer),this.resetResults();var a=n(this.resultsContainer);0!==a.length&&(_.isUndefined(e)||_.isUndefined(e.columns)||(this.columns=e.columns),a.data("card-columns",this.columns),a.attr("data-card-columns",this.columns),_.isUndefined(r.controllers.dataService.response.listings)||0===r.controllers.dataService.response.listings.length||(a.html("").addClass("listing-cards-anchor--active"),_.each(r.controllers.dataService.response.listings,function(e){a.append(t.resultTemplate(e))})),this.resultsContainer=s)},resetResults:function(){this.setFound(),n(this.resultsContainer).removeClass("listing-cards-anchor--active").html(this.noResultsTemplate({noResults:r.settings.i18n.noResults}))},setFound:function(){}}),r.DataServices.WPJobManager=r.DataService.extend({isAddressGeocoded:!1,prevAddress:n("#search_location").val(),$target:n("div.job_listings"),$form:n("form.job_filters"),$address:n('[name="search_location"]'),$lat:n("#search_lat"),$region:n("#search_region"),$lng:n("#search_lng"),$radius:n("#search_radius"),$searchThisLocation:n("#search_this_location"),autoComplete:"search_location",initialize:function(e){var s;r.DataService.prototype.initialize.call(e),this.resultsContainer=this.$target.children("ul.job_listings"),this.$form.on("submit",function(e){e.preventDefault()}),this.radiusSlider(),this.locateMe(),0!==this.$target.length&&((s=this).$target.on("updated_results",function(e,t){s.response=t,"resolved"!==s.activeResponse.state()&&(i.console&&r.settings.scriptDebug&&console.log("Data Service ready..."),s.activeResponse.resolve()),s.$target.find(".search-sort").toggle(!s.isAddressGeocoded),n(a).trigger("listifyDataServiceLoaded")}),this.$target.on("reset",function(e){t!==this.$radius&&this.$radius.val(r.settings.dataService.wpjobmanager.searchRadiusDefault),t!==this.$lat&&this.$lat.val(""),t!==this.$lng&&this.$lng.val(""),t!==this.$region&&this.$region.val("")}),this.$target.on("update_results",function(e){s.maybeReverseGeocode()}))},update:function(){this.$target.triggerHandler("update_results",[1,!1])},maybeReverseGeocode:function(){r.controllers.mapService&&r.controllers.mapService.geocode&&(""!==this.$address.val()?(this.$address.val()!=this.prevAddress&&(this.isAddressGeocoded=!1),this.isAddressGeocoded||this.isAddressGeocoding||r.controllers.mapService.geocode(this.$address.val())):""===this.$searchThisLocation.val()&&(this.$radius.val(r.settings.dataService.wpjobmanager.searchRadiusDefault),this.$lat.val(""),this.$lng.val("")))},getDefaultCoordinates:function(){return this.$lat.val()&&"0"!=this.$lat.val()?{lat:this.$lat.val(),lng:this.$lng.val()}:{lat:parseFloat(r.settings.mapService.center[0]),lng:parseFloat(r.settings.mapService.center[1])}},radiusSearch:function(e,t){this.$lat.val(e),this.$lng.val(t),this.update()},radiusSlider:function(){var s=this;n(".search-radius-slider div").each(function(e){var t=noUiSlider.create(this,{format:wNumb({decimals:0}),step:1,start:[r.settings.dataService.wpjobmanager.searchRadiusDefault],range:{min:parseInt(r.settings.dataService.wpjobmanager.searchRadiusMin),max:parseInt(r.settings.dataService.wpjobmanager.searchRadiusMax)}});t.on("set",s.updateRadius),t.on("set",function(){s.update()})})},updateRadius:function(e,t){n(".radi").text(e[0]),n("#search_radius").val(e[0])},locateMe:function(){var t;navigator.geolocation&&r.settings.isSSL&&(t=this,n(a).ready(function(){!_.isUndefined(r.controllers.mapService)&&r.controllers.mapService.geocode&&(n(".search_location").append('<i class="locate-me"></i>'),n(".locate-me").on("click",function(e){e.preventDefault(),n(this).addClass("loading"),navigator.geolocation.getCurrentPosition(t.locateMeSuccess.bind(t),null,{enableHighAccuracy:!0})}))}))},locateMeSuccess:function(e){var t=e.coords.latitude,e=e.coords.longitude;!_.isUndefined(r.controllers.mapService)&&r.controllers.mapService.geocode&&(r.controllers.mapService.geocode(t+", "+e),n(".locate-me").removeClass("loading"))},searchThisLocation:function(){var e=r.controllers.mapService.getCenterLat(),t=r.controllers.mapService.getCenterLng(),s=r.controllers.mapService.getRadius();this.$lat.val(e),this.$lng.val(t),this.$radius.val(s),this.$searchThisLocation.val("1"),this.update(),this.$searchThisLocation.val("")},setFound:function(){var e=_.isUndefined(r.controllers.dataService.response.found_posts)?0:r.controllers.dataService.response.found_posts,t=_.isUndefined(r.controllers.dataService.response.offset)?"":" "+r.controllers.dataService.response.offset;n(".results-found").html(r.settings.i18n.resultsFound.replace("%d",e)+t)}}),r.DataServices.FacetWP=r.DataService.extend({resultsContainer:".facetwp_job_listings ul.job_listings",initialize:function(e){r.DataService.prototype.initialize.call(e);var s=this;n(a).on("facetwp-loaded",function(e,t){_.isUndefined(FWP.settings.listify)||(s.response=FWP.settings.listify,"resolved"!==s.activeResponse.state()?(i.console&&r.settings.scriptDebug&&console.log("Data Service ready..."),s.activeResponse.resolve()):_.isUndefined(r.controllers.mapService)||r.controllers.mapService.addMarkers(s.response.listings),n(a).trigger("listifyDataServiceLoaded"))})},getDefaultCoordinates:function(){var e,t=r.settings.mapService.center[0],s=r.settings.mapService.center[1];return 0<n(".facetwp-type-proximity").length&&(e=n(".facetwp-type-proximity").data("name"),FWP.facets[e]&&FWP.facets[e].length&&(t=FWP.facets[e][0],s=FWP.facets[e][1])),{lat:parseFloat(t),lng:parseFloat(s)}},searchThisLocation:function(){var e=r.controllers.mapService.getCenterLat(),t=r.controllers.mapService.getCenterLng(),s=r.controllers.mapService.getRadius();n("#facetwp-radius").append(n("<option>",{value:s,text:s})),n("#facetwp-radius").val(s),n(".facetwp-lat").attr("value",e),n(".facetwp-lng").attr("value",t),FWP.refresh()}}),"facetwp"==r.settings.dataService.service?r.controllers.dataService=new r.DataServices.FacetWP:r.controllers.dataService=new r.DataServices.WPJobManager,n(a).on("listifyDataServiceLoaded",function(){r.controllers.dataService.addResults()}),n("#search-this-location").click(function(e){e.preventDefault(),r.controllers.dataService.searchThisLocation()}),!jQuery("form#jobFiltersResult").length||(e=jQuery("button.update_results")).length&&(e.click(),setTimeout(function(){e.trigger("click")},100))}(window);